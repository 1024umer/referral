import{d as N}from"./default-d995b69a.js";import"./sweetalert2.all-780908a9.js";import{_ as V,e as h,w as l,r as d,o as f,a as s,d as u,t as g}from"./app-24574b50.js";const q=new N("users"),D={computed:{user(){return this.$store.getters.loggedInUser},leadStatuses(){return[{name:"All",id:0,bgClass:"",forGrid:!1},...this.$store.getters.getLeadStatuses]}},components:{UserAvatar,LeadPopupModalNew},data(){return{lead_id:0,leadPopup:{dialog:!1,leadData:{}},serverItems:[],totalItems:0,loading:!1,itemsPerPage:10,search:"",headers:[{title:"ID",align:"start",sortable:!0,key:"id"},{title:"Full Name",align:"start",sortable:!0,key:"name"},{title:"Email",align:"start",sortable:!0,key:"email"}],modalOpen:!1,selectedUser:null,selectedContactOwner:null,contactOwners:[],users:[],form:{user_id:null}}},methods:{async refreshLastLead(){const i=await itemtypeservice.get(this.leadPopup.leadData.id);this.showLeadPopupNew(i)},async showLeadPopupNew(i){const a=await itemtypeservice.get(i.id),r=await otherrequestservice.get("leads/"+a.id+"/activities").then(o=>o.data.activities);let n=await templateservice.getlist("?lead_id="+a.id).then(o=>o.data);const e=[{id:0,name:"No Template"},...n];this.leadPopup.dialog=!0,this.leadPopup.leadData=a,this.leadPopup.leadData.activities=r,this.leadPopup.leadData.templates=e},async fetchContactOwners(){try{const i=await q.getlist();this.users=i.data}catch(i){console.error("Error fetching users:",i)}},openModal(i){this.selectedUser=i,this.selectedContactOwner=(i==null?void 0:i.user_id)||null,this.form.user_id=this.selectedContactOwner,this.modalOpen=!0},closeModal(){this.selectedUser=null,this.selectedContactOwner=null,this.modalOpen=!1},async updateContactOwner(){this.closeModal()},async loadItems({page:i,itemsPerPage:a,sortBy:r}){this.loading=!0,this.serverItems=[];var n="";n+="?page="+i;try{if(r.length>0){let o=r[0].key;(o="updated_at_formatted")&&(o="updated_at"),n+="&sortCol="+o,n+="&sortByDesc="+r[0].order}}catch{}n+="&perpage="+a,this.lead_id>0&&(n+="&lead_status="+this.lead_id),this.search!=""&&(n+="&search="+this.search),this.$route.query.is_client||(n+="&getall=true");const e=await itemtypeservice.getlist(n);this.serverItems=e.data;try{this.totalItems=e.meta.total}catch{this.totalItems=0}this.loading=!1}},watch:{$route(){this.$route.query.lead_status?parseInt(this.$route.query.lead_status)>0?this.lead_id=parseInt(this.$route.query.lead_status):this.lead_id=0:this.lead_id=0,this.loadItems({page:1,itemsPerPage:10})},itemsPerPage(){this.loadItems({page:1,itemsPerPage:10})},search(){this.loadItems({page:1,itemsPerPage:10})},lead_id(){this.loadItems({page:1,itemsPerPage:10})}},async mounted(){if(await this.fetchContactOwners(),this.loadItems({page:1,itemsPerPage:10}),this.$route.query.lead_id&&parseInt(this.$route.query.lead_id)>0){var i=this.$route.query.lead_id;itemtypeservice.get(i).then(a=>{this.showLeadPopupNew(a)})}this.$route.query.lead_status&&parseInt(this.$route.query.lead_status)>0&&(this.lead_id=parseInt(this.$route.query.lead_status))}},M=u("User Information"),S=u("Cancel"),E=u("Update");function A(i,a,r,n,e,o){const w=d("v-text-field"),c=d("v-col"),v=d("v-select"),m=d("v-row"),y=d("user-avatar"),P=d("v-badge"),p=d("v-btn"),b=d("v-data-table-server"),I=d("v-card-title"),C=d("v-card-text"),L=d("v-spacer"),k=d("v-card-actions"),x=d("v-card"),O=d("v-dialog"),U=d("LeadPopupModalNew");return f(),h(m,null,{default:l(()=>[s(c,{cols:"12"},{default:l(()=>[s(m,null,{default:l(()=>[s(c,null,{default:l(()=>[s(w,{"prepend-inner-icon":"mdi-magnify",modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=t=>e.search=t),label:"Search Leads By First Name, Last Name, Email, Phone",variant:"underlined"},null,8,["modelValue"])]),_:1}),s(c,null,{default:l(()=>[s(v,{"item-title":"name","item-value":"id",label:"Leads Status",items:o.leadStatuses,modelValue:e.lead_id,"onUpdate:modelValue":a[1]||(a[1]=t=>e.lead_id=t)},null,8,["items","modelValue"])]),_:1})]),_:1}),s(b,{"items-per-page":e.itemsPerPage,"onUpdate:items-per-page":a[2]||(a[2]=t=>e.itemsPerPage=t),headers:e.headers,"items-length":e.totalItems,items:e.serverItems,loading:e.loading,"item-value":"id","loading-text":"Loading","onUpdate:options":o.loadItems},{"item.user_id":l(({item:t})=>[s(y,{user:t.selectable.user,onClick:_=>o.openModal(t.selectable.user)},null,8,["user","onClick"])]),"item.lead_status":l(({item:t})=>[u(g(o.leadStatuses.find(_=>_.id==t.selectable.lead_status).name),1)]),"item.client_id":l(({item:t})=>[t.selectable.client_id==0?(f(),h(P,{key:0,color:"error",content:"No",inline:""})):(f(),h(P,{key:1,color:"success",content:"Yes",inline:""}))]),"item.full_name":l(({item:t})=>[s(p,{onClick:_=>o.showLeadPopupNew(t.selectable),class:"text-decoration-underline",variant:"plain"},{default:l(()=>[u(g(t.selectable.full_name),1)]),_:2},1032,["onClick"])]),"item.email":l(({item:t})=>[u(g(t.selectable.email),1)]),_:1},8,["items-per-page","headers","items-length","items","loading","onUpdate:options"])]),_:1}),s(O,{modelValue:e.modalOpen,"onUpdate:modelValue":a[4]||(a[4]=t=>e.modalOpen=t),persistent:"","max-width":"400"},{default:l(()=>[s(x,null,{default:l(()=>[s(I,{class:"headline"},{default:l(()=>[M]),_:1}),s(C,null,{default:l(()=>[s(m,null,{default:l(()=>[s(c,null,{default:l(()=>[s(c,{cols:"12"},{default:l(()=>[s(v,{"item-title":"name","item-value":"id",label:"User*",items:e.users,modelValue:e.form.user_id,"onUpdate:modelValue":a[3]||(a[3]=t=>e.form.user_id=t)},null,8,["items","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(k,null,{default:l(()=>[s(L),s(p,{color:"blue darken-1",text:"",onClick:o.closeModal},{default:l(()=>[S]),_:1},8,["onClick"]),s(p,{color:"blue darken-1",text:"",onClick:o.updateContactOwner},{default:l(()=>[E]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(U,{onRefreshLead:o.refreshLastLead,templates:e.leadPopup.leadData.templates,onOpenLastLead:a[5]||(a[5]=t=>e.leadPopup.dialog=!0),onCloseLead:a[6]||(a[6]=t=>e.leadPopup.dialog=!1),dialog:e.leadPopup.dialog,lead:e.leadPopup.leadData},null,8,["onRefreshLead","templates","dialog","lead"])]),_:1})}const T=V(D,[["render",A],["__scopeId","data-v-4bfab79f"]]);export{T as default};
